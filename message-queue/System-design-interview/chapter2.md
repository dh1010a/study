# 챕터 2. 개략적인 규모 추정

- 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위
- 어떤 설계가 요구사항에 부합한지 보기 위한 것
- 기본기로 2의 제곱수나 응답지연(latency)값, 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 함

## 2의 제곱수
- 데이터 볼륨의 단위를 2의 제곱수로 표현하면, 최소 단위는 1byte = 8 bit로 구성
- 아스키 문자 하나가 차지하는 메모리 크기가 1바이트임
- 보통 많이 사용되는 UTF-8의 경우 1~4바이트 사용
- 한글 또는 다국어를 고려하기 위해 한 단어를 4바이트 까지 고려하는것이 좋음

|2의 x 제곱| 근사치 | 이름 | 축약형|
| --- | --- | --- | --- |
|10| 1천(thousand)| 1킬로바이트| 1KB|
|20| 1백만(million)| 1메가바이트|1MB|
|30| 10억(billion) | 1기가바이트| 1GB|
|40| 1조(trillion) | 1테라바이트|1TB|
|50| 1000조(1quadrillion)|1페타바이트|1PB|

## 응답 지연 값
- ns: nanosecond(나노초), μs: microsecond(마이크로초),ms: millisecond(밀리초)
- 1 나노초 = 10^-9 초
- 1 마이크로초 = 10^-6초 = 1000 나노초
- 1 밀리초 = 10-3초 = 1,000μs = 1,000,000ns

|연산명	|시간|
|---|---|
|뮤텍스 락/언락|	100ns|
|주 메모리 참조|	100ns|
|Zippy로 1KB 압축|	10μs|
|1Gbps 네트워크로 2KB 전송	|20,000ns = 10μs|
|메모리에서 1MB 순차적으로 |read	500,000ns = 250μs|
|디스크 탐색|	10ms|
|네트워크에서 1MB 순차적으로 read	|10ms|
|디스크에서 1MB 순차적으로 read|	30ms|
|한 패킷의 캘리포니아로부터 네델란드까지의 왕복 지연시간	|150ms|

- 메모리는 빠르지만 디스크는 아직도 느리다
- 디스크 탐색은 가능한 피해라
- 단순 압축 알고리즘은 빠르다
- 데이터를 인터넷에 전송하기 전에 가능하면 압축해라(gzip)
- 데이터 센터는 보통 여러 지역에 분산되어 있고 센터들 간에 데이터를 주고받는 데에는 시간이 걸린다

## 가용성과 관련된 수치
- 고가용성은 시스템이 오랜시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭
- 퍼센트로 표시
- 100퍼센트는 한번도 중단된 적이 없었음을 의미
- SLA(Service Level Agreement)는 서비스 사업자가 보편적으로 사용하는 말로, 서비스 사업자와 고객 사이에 맺어진 합의
- 이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술

|가용률 시간| 연간 장애 시간|
| --- | --- |
|99%|3.65일|
|99.9%|8.77시간|
|99.99%|52.60분|
|99.999%|5.26분|

## 트위터 QPS와 저장소 요구량 측정
### 가정
- 월간 능동 사용자(monthly active user)는 3억명
- 50%의 사용자가 트위터를 매일 사용
- 평균적으로 각 사용자는 2건의 트윗을 올림
- 미디어틀 포함하는 트윗은 10%정도
- 데이터는 5년간 보관

### 추정
QPS(Query Per Second) 추정치
- 일간 능동 사용자(Daily Active User, DAU) = 3억 * 50% = 1.5억(150million)
- QPS = 1.5억 * 2트윗  / 24시간 / 3600초 = 3500
- 최대 QPS = 2 * QPS = 약 7000

### 미디어 저장을 위한 저장소 요구량
- 평균 트윗 크키
  - tweet_id에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB
- 미디어 저장소 요구량
  - 1.5억 * 2(개) * 10% * 1MB = 30TB/일
- 데이터는 5년간 보관
  - 30 TB * 365 * 5 = 약 55PB
 

## 팁
- 개략적인 규모 추청과 관계된 면접에서 가장 중요한 것은 문제를 풀어나가는 절차
- 올바른 절차를 밟느냐가 결과를 내는 것보다 중요, 문제 해결 능력을 보고싶어함
  - 근사치를 활용한 계산을 할 줄 알아야함 (반올림, 내림, 올림)
  - 가정은 미리 적어놔야 나중에 볼 수 있음
  - 단위(unit)을 붙이는 습관을 들이기
  - QPS, 최대 QPS, 저장소 요구량, 캐시 요구량,서버 수 등을 추정하는 방법을 미리 연습하기
